</div>";$(calendarNavHtml).appendTo($calendarContainer);$calendarContainer.find(".wc-nav .wc-today").button({icons:{primary:'ui-icon-home'}}).click(function(){self.today();return false});$calendarContainer.find(".wc-nav .wc-prev").button({text:false,icons:{primary:'ui-icon-seek-prev'}}).click(function(){self.element.weekCalendar('prev');return false});$calendarContainer.find(".wc-nav .wc-next").button({text:false,icons:{primary:'ui-icon-seek-next'}}).click(function(){self.element.weekCalendar('next');return false});if(this.options.switchDisplay&&$.isPlainObject(this.options.switchDisplay)){var $container=$calendarContainer.find(".wc-display");$.each(this.options.switchDisplay,function(label,option){var _id='wc-switch-display-'+option;var _input=$('<input type="radio" id="'+_id+'" name="wc-switch-display" class="wc-switch-display"/>');var _label=$('<label for="'+_id+'"></label>');_label.html(label);_input.val(option);if(parseInt(self.options.daysToShow,10)===parseInt(option,10)){_input.attr('checked','checked')}$container.append(_input).append(_label)});$container.find('input').change(function(){self.setDaysToShow(parseInt($(this).val(),10))})}$calendarContainer.find(".wc-nav, .wc-display").buttonset();var _height=$calendarContainer.find(".wc-nav").outerHeight();$calendarContainer.find(".wc-title").height(_height).css('line-height',_height+'px')}},_renderCalendarHeader:function($calendarContainer){var self=this,options=this.options,showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,rowspan="",colspan='',calendarHeaderHtml;if(showAsSeparatedUser){rowspan=" rowspan=\"2\"";colspan=" colspan=\""+options.users.length+"\" "}calendarHeaderHtml="<div class=\"ui-widget-content wc-header\">";calendarHeaderHtml+="<table><tbody><tr><td class=\"wc-time-column-header\"></td>";for(var i=1;i<=options.daysToShow;i++){calendarHeaderHtml+="<td class=\"wc-day-column-header wc-day-"+i+"\""+colspan+"></td>"}calendarHeaderHtml+="<td class=\"wc-scrollbar-shim\""+rowspan+"></td></tr>";if(showAsSeparatedUser){calendarHeaderHtml+="<tr><td class=\"wc-time-column-header\"></td>";var uLength=options.users.length,_headerClass='';for(var i=1;i<=options.daysToShow;i++){for(var j=0;j<uLength;j++){_headerClass=[];if(j==0){_headerClass.push('wc-day-column-first')}if(j==uLength-1){_headerClass.push('wc-day-column-last')}if(!_headerClass.length){_headerClass='wc-day-column-middle'}else{_headerClass=_headerClass.join(' ')}calendarHeaderHtml+="<td class=\""+_headerClass+" wc-user-header wc-day-"+i+" wc-user-"+self._getUserIdFromIndex(j)+"\">";calendarHeaderHtml+=self._getUserName(j);calendarHeaderHtml+="</td>"}}calendarHeaderHtml+="</tr>"}calendarHeaderHtml+="</tbody></table></div>";$(calendarHeaderHtml).appendTo($calendarContainer)},_renderCalendarBody:function($calendarContainer){var self=this,options=this.options,showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,$calendarBody,$calendarTableTbody;$calendarBody="<div class=\"wc-scrollable-grid\">";$calendarBody+="<table class=\"wc-time-slots\">";$calendarBody+="<tbody>";$calendarBody+="</tbody>";$calendarBody+="</table>";$calendarBody+="</div>";$calendarBody=$($calendarBody);$calendarTableTbody=$calendarBody.find('tbody');self._renderCalendarBodyTimeSlots($calendarTableTbody);self._renderCalendarBodyOddEven($calendarTableTbody);self._renderCalendarBodyFreeBusy($calendarTableTbody);self._renderCalendarBodyEvents($calendarTableTbody);$calendarBody.appendTo($calendarContainer);$calendarContainer.find('.wc-full-height-column').height(options.timeslotHeight*options.timeslotsPerDay);$calendarContainer.find(".wc-time-slot").height(options.timeslotHeight-1);$calendarContainer.find(".wc-time-header-cell").css({height:(options.timeslotHeight*options.timeslotsPerHour)-11,padding:5});if(showAsSeparatedUser){for(var i=0,uLength=options.users.length;i<uLength;i++){$calendarContainer.find('.wc-user-'+self._getUserIdFromIndex(i)).data('wcUser',options.users[i]).data('wcUserIndex',i).data('wcUserId',self._getUserIdFromIndex(i))}}},_renderCalendarBodyTimeSlots:function($calendarTableTbody){var options=this.options,renderRow,i,j,showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,start=(options.businessHours.limitDisplay?options.businessHours.start:0),end=(options.businessHours.limitDisplay?options.businessHours.end:24),rowspan=1;if(options.displayOddEven){rowspan+=1}if(options.displayFreeBusys){rowspan+=1}if(rowspan>1){rowspan=" rowspan=\""+rowspan+"\""}else{rowspan=""}$(renderRow).appendTo($calendarTableTbody)},_renderCalendarBodyOddEven:function($calendarTableTbody){if(this.options.displayOddEven){var options=this.options,renderRow="<tr class=\"wc-grid-row-oddeven\">",showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,oddEven;for(var i=1;i<=options.daysToShow;i++){if(options.displayOddEven){if(!showAsSeparatedUser){oddEven=(oddEven=="odd"?'even':'odd');renderRow+="<td class=\"wc-day-column day-"+i+"\">";renderRow+="<div class=\"wc-no-height-wrapper wc-oddeven-wrapper\">";renderRow+="<div class=\"wc-full-height-column wc-column-"+oddEven+"\"></div>";renderRow+="</div>";renderRow+="</td>"}else{var uLength=options.users.length;for(var j=0;j<uLength;j++){oddEven=(oddEven=="odd"?'even':'odd');renderRow+="<td class=\"wc-day-column day-"+i+"\">";renderRow+="<div class=\"wc-no-height-wrapper wc-oddeven-wrapper\">";renderRow+="<div class=\"wc-full-height-column wc-column-"+oddEven+"\" ></div>";renderRow+="</div>";renderRow+="</td>"}}}}renderRow+="</tr>";$(renderRow).appendTo($calendarTableTbody)}},_renderCalendarBodyFreeBusy:function($calendarTableTbody){if(this.options.displayFreeBusys){var self=this,options=this.options,renderRow="<tr class=\"wc-grid-row-freebusy\">",showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length;renderRow+="</td>";for(var i=1;i<=options.daysToShow;i++){if(options.displayFreeBusys){if(!showAsSeparatedUser){renderRow+="<td class=\"wc-day-column day-"+i+"\">";renderRow+="<div class=\"wc-no-height-wrapper wc-freebusy-wrapper\">";renderRow+="<div class=\"wc-full-height-column wc-column-freebusy wc-day-"+i+"\"></div>";renderRow+="</div>";renderRow+="</td>"}else{var uLength=options.users.length;for(var j=0;j<uLength;j++){renderRow+="<td class=\"wc-day-column day-"+i+"\">";renderRow+="<div class=\"wc-no-height-wrapper wc-freebusy-wrapper\">";renderRow+="<div class=\"wc-full-height-column wc-column-freebusy wc-day-"+i;renderRow+=" wc-user-"+self._getUserIdFromIndex(j)+"\">";renderRow+="</div>";renderRow+="</div>";renderRow+="</td>"}}}}renderRow+="</tr>";$(renderRow).appendTo($calendarTableTbody)}},_renderCalendarBodyEvents:function($calendarTableTbody){var self=this,options=this.options,renderRow,showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,start=(options.businessHours.limitDisplay?options.businessHours.start:0),end=(options.businessHours.limitDisplay?options.businessHours.end:24);renderRow="<tr class=\"wc-grid-row-events\">";renderRow+="<td class=\"wc-grid-timeslot-header\">";for(var i=start;i<end;i++){var bhClass=(options.businessHours.start<=i&&options.businessHours.end>i)?"ui-state-active wc-business-hours":"ui-state-default";renderRow+="<div class=\"wc-hour-header "+bhClass+"\">";if(options.use24Hour){renderRow+="<div class=\"wc-time-header-cell\">"+self._24HourForIndex(i)+"</div>"}else{renderRow+="<div class=\"wc-time-header-cell\">"+self._hourForIndex(i)+"<span class=\"wc-am-pm\">"+self._amOrPm(i)+"</span></div>"}renderRow+="</div>"}renderRow+="</td>";for(var i=1;i<=options.daysToShow;i++){if(!showAsSeparatedUser){renderRow+="<td class=\"wc-day-column wc-day-column-first wc-day-column-last day-"+i+"\">";renderRow+="<div class=\"wc-full-height-column wc-day-column-inner day-"+i+"\"></div>";renderRow+="</td>"}else{var uLength=options.users.length;var columnclass;for(var j=0;j<uLength;j++){columnclass=[];if(j==0){columnclass.push('wc-day-column-first')}if(j==uLength-1){columnclass.push('wc-day-column-last')}if(!columnclass.length){columnclass='wc-day-column-middle'}else{columnclass=columnclass.join(' ')}renderRow+="<td class=\"wc-day-column "+columnclass+" day-"+i+"\">";renderRow+="<div class=\"wc-full-height-column wc-day-column-inner day-"+i;renderRow+=" wc-user-"+self._getUserIdFromIndex(j)+"\">";renderRow+="</div>";renderRow+="</td>"}}}renderRow+="</tr>";$(renderRow).appendTo($calendarTableTbody)},_setupEventCreationForWeekDay:function($weekDay){var self=this;var options=this.options;$weekDay.mousedown(function(event){var $target=$(event.target);if($target.hasClass("wc-day-column-inner")){var $newEvent=$("<div class=\"wc-cal-event wc-new-cal-event wc-new-cal-event-creating\"></div>");$newEvent.css({lineHeight:(options.timeslotHeight-2)+"px",fontSize:(options.timeslotHeight/2)+"px"});$target.append($newEvent);var columnOffset=$target.offset().top;var clickY=event.pageY-columnOffset;var clickYRounded=(clickY-(clickY%options.timeslotHeight))/options.timeslotHeight;var topPosition=clickYRounded*options.timeslotHeight;$newEvent.css({top:topPosition});if(!options.preventDragOnEventCreation){$target.bind("mousemove.newevent",function(event){$newEvent.show();$newEvent.addClass("ui-resizable-resizing");var height=Math.round(event.pageY-columnOffset-topPosition);var remainder=height%options.timeslotHeight;if(remainder<0){var useHeight=height-remainder;$newEvent.css("height",useHeight<options.timeslotHeight?options.timeslotHeight:useHeight)}else{$newEvent.css("height",height+(options.timeslotHeight-remainder))}}).mouseup(function(){$target.unbind("mousemove.newevent");$newEvent.addClass("ui-corner-all")})}}}).mouseup(function(event){var $target=$(event.target);var $weekDay=$target.closest(".wc-day-column-inner");var $newEvent=$weekDay.find(".wc-new-cal-event-creating");if($newEvent.length){if(!$newEvent.hasClass("ui-resizable-resizing")){$newEvent.css({height:options.timeslotHeight*options.defaultEventLength}).show()}var top=parseInt($newEvent.css("top"));var eventDuration=self._getEventDurationFromPositionedEventElement($weekDay,$newEvent,top);$newEvent.remove();var newCalEvent={start:eventDuration.start,end:eventDuration.end,title:options.newEventText};var showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length;if(showAsSeparatedUser){newCalEvent=self._setEventUserId(newCalEvent,$weekDay.data('wcUserId'))}else if(!options.showAsSeparateUsers&&options.users&&options.users.length==1){newCalEvent=self._setEventUserId(newCalEvent,self._getUserIdFromIndex(0))}var freeBusyManager=self.getFreeBusyManagerForEvent(newCalEvent);var $renderedCalEvent=self._renderEvent(newCalEvent,$weekDay);if(!options.allowCalEventOverlap){self._adjustForEventCollisions($weekDay,$renderedCalEvent,newCalEvent,newCalEvent);self._positionEvent($weekDay,$renderedCalEvent)}else{self._adjustOverlappingEvents($weekDay)}options.eventNew(newCalEvent,$renderedCalEvent,freeBusyManager,self.element,event)}})},_loadCalEvents:function(dateWithinWeek){var date,weekStartDate,weekEndDate,$weekDayColumns;var self=this;var options=this.options;date=dateWithinWeek||options.date;if((!date||!date.getTime)||(!options.date||!options.date.getTime)||date.getTime()!=options.date.getTime()){this._trigger('changedate',this.element,date)}this.options.date=date;weekStartDate=self._dateFirstDayOfWeek(date);weekEndDate=self._dateLastMilliOfWeek(date);options.calendarBeforeLoad(self.element);self.element.data("startDate",weekStartDate);self.element.data("endDate",weekEndDate);$weekDayColumns=self.element.find(".wc-day-column-inner");self._updateDayColumnHeader($weekDayColumns);if(typeof options.data=='string'){if(options.loading){options.loading(true)}if(_currentAjaxCall){_currentAjaxCall.abort();if(options.loading){options.loading(false)}}var jsonOptions=self._getJsonOptions();jsonOptions[options.startParam||'start']=Math.round(weekStartDate.getTime()/1000);jsonOptions[options.endParam||'end']=Math.round(weekEndDate.getTime()/1000);_currentAjaxCall=$.ajax({url:options.data,data:jsonOptions,dataType:'json',error:function(XMLHttpRequest,textStatus,errorThrown){alert('unable to get data, error:'+textStatus)},success:function(data){self._renderEvents(data,$weekDayColumns)},complete:function(){_currentAjaxCall=null;if(options.loading){options.loading(false)}}})}else if($.isFunction(options.data)){options.data(weekStartDate,weekEndDate,function(data){self._renderEvents(data,$weekDayColumns)})}else if(options.data){self._renderEvents(options.data,$weekDayColumns)}self._disableTextSelect($weekDayColumns)},_updateDayColumnHeader:function($weekDayColumns){var self=this;var options=this.options;var currentDay=self._cloneDate(self.element.data("startDate"));var showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length;self.element.find(".wc-header td.wc-day-column-header").each(function(i,val){$(this).html(self._getHeaderDate(currentDay));if(self._isToday(currentDay)){$(this).addClass("wc-today")}else{$(this).removeClass("wc-today")}currentDay=self._addDays(currentDay,1)});currentDay=self._cloneDate(self.element.data("startDate"));if(showAsSeparatedUser){self.element.find('.wc-header td.wc-user-header').each(function(i,val){if(self._isToday(currentDay)){$(this).addClass("wc-today")}else{$(this).removeClass("wc-today")}currentDay=((i+1)%options.users.length)?currentDay:self._addDays(currentDay,1)})}currentDay=self._cloneDate(self.element.data("startDate"));$weekDayColumns.each(function(i,val){$(this).data("startDate",self._cloneDate(currentDay));$(this).data("endDate",new Date(currentDay.getTime()+(MILLIS_IN_DAY)));if(self._isToday(currentDay)){$(this).parent().addClass("wc-today")}else{$(this).parent().removeClass("wc-today")}if(!showAsSeparatedUser||!((i+1)%options.users.length)){currentDay=self._addDays(currentDay,1)}});if(options.displayFreeBusys){currentDay=self._cloneDate(self.element.data("startDate"));self.element.find('.wc-grid-row-freebusy .wc-column-freebusy').each(function(i,val){$(this).data("startDate",self._cloneDate(currentDay));$(this).data("endDate",new Date(currentDay.getTime()+(MILLIS_IN_DAY)));if(!showAsSeparatedUser||!((i+1)%options.users.length)){currentDay=self._addDays(currentDay,1)}})}if(this.options.title&&this.options.title.length){var _date=this.options.date,_start=self._cloneDate(self.element.data("startDate")),_end=self._dateLastDayOfWeek(new Date(this._cloneDate(self.element.data("endDate")).getTime()-(MILLIS_IN_DAY))),_title=this._getCalendarTitle();_title=_title.split('%start%').join(self._formatDate(_start,options.dateFormat));_title=_title.split('%end%').join(self._formatDate(_end,options.dateFormat));_title=_title.split('%date%').join(self._formatDate(_date,options.dateFormat));$('.wc-toolbar .wc-title',self.element).html(_title)}},_getCalendarTitle:function(){if($.isFunction(this.options.title)){return this.options.title(this.options.daysToShow)}return this.options.title},_renderEvents:function(data,$weekDayColumns){var self=this;var options=this.options;var eventsToRender;if(data.options){var updateLayout=false;$.each(data.options,function(key,value){if(value!==options[key]){options[key]=value;updateLayout=updateLayout||$.ui.weekCalendar.updateLayoutOptions[key]}});self._computeOptions();if(updateLayout){var hour=self._getCurrentScrollHour();self.element.empty();self._renderCalendar();$weekDayColumns=self.element.find(".wc-time-slots .wc-day-column-inner");self._updateDayColumnHeader($weekDayColumns);self._resizeCalendar();self._scrollToHour(hour,false)}}this._clearCalendar();if($.isArray(data)){eventsToRender=self._cleanEvents(data)}else if(data.events){eventsToRender=self._cleanEvents(data.events);self._renderFreeBusys(data)}$.each(eventsToRender,function(i,calEvent){var initialStart=new Date(calEvent.start);var initialEnd=new Date(calEvent.end);var maxHour=self.options.businessHours.limitDisplay?self.options.businessHours.end:24;var minHour=self.options.businessHours.limitDisplay?self.options.businessHours.start:0;var start=new Date(initialStart);var endDay=initialEnd.getDay();var $weekDay;var isMultiday=false;while(start.getDay()<endDay){calEvent.start=start;calEvent.end.setFullYear(start.getFullYear());calEvent.end.setMonth(start.getMonth());calEvent.end.setDate(start.getDate());calEvent.end.setHours(maxHour);calEvent.end.setMinutes(0);calEvent.end.setSeconds(0);if(($weekDay=self._findWeekDayForEvent(calEvent,$weekDayColumns))){self._renderEvent(calEvent,$weekDay)}start.setDate(start.getDate()+1);start.setHours(minHour);start.setMinutes(0);start.setSeconds(0);isMultiday=true}if(start<=initialEnd){calEvent.start=start;calEvent.end=initialEnd;if(((isMultiday&&calEvent.start.getTime()!=calEvent.end.getTime())||!isMultiday)&&($weekDay=self._findWeekDayForEvent(calEvent,$weekDayColumns))){self._renderEvent(calEvent,$weekDay)}}calEvent.start=initialStart});$weekDayColumns.each(function(){self._adjustOverlappingEvents($(this))});options.calendarAfterLoad(self.element);if(!eventsToRender.length){options.noEvents()}},_renderEvent:function(calEvent,$weekDay){var self=this;var options=this.options;if(calEvent.start.getTime()>calEvent.end.getTime()){return}var eventClass,eventHtml,$calEventList,$modifiedEvent;eventClass=calEvent.id?"wc-cal-event":"wc-cal-event wc-new-cal-event";eventHtml="<div class=\""+eventClass+" ui-corner-all\">"+(options.displayEventHeader?"<div class=\"wc-time ui-corner-top\"></div>":"")+"<div class=\"wc-title\"></div></div>"$weekDay.each(function(){var $calEvent=$(eventHtml);$modifiedEvent=options.eventRender(calEvent,$calEvent);$calEvent=$modifiedEvent?$modifiedEvent.appendTo($(this)):$calEvent.appendTo($(this));$calEvent.css({lineHeight:(options.textSize+2)+"px",fontSize:options.textSize+"px"});self._refreshEventDetails(calEvent,$calEvent);self._positionEvent($(this),$calEvent);if($calEventList){$calEventList=$calEventList.add($calEvent)}else{$calEventList=$calEvent}});$calEventList.show();if(!options.readonly&&options.resizable(calEvent,$calEventList)){self._addResizableToCalEvent(calEvent,$calEventList,$weekDay)}if(!options.readonly&&options.draggable(calEvent,$calEventList)){self._addDraggableToCalEvent(calEvent,$calEventList)}options.eventAfterRender(calEvent,$calEventList);return $calEventList},addEvent:function(){return this._renderEvent.apply(this,arguments)},_adjustOverlappingEvents:function($weekDay){var self=this;if(self.options.allowCalEventOverlap){var groupsList=self._groupOverlappingEventElements($weekDay);$.each(groupsList,function(){var curGroups=this;$.each(curGroups,function(groupIndex){var curGroup=this;if(self.options.overlapEventsSeparate){var newWidth=100/curGroups.length;var newLeft=groupIndex*newWidth}else{var newWidth=100-((curGroups.length-1)*10);var newLeft=groupIndex*10}$.each(curGroup,function(){if(!self.options.overlapEventsSeparate){$(this).bind("mouseover.z-index",function(){var $elem=$(this);$.each(curGroup,function(){$(this).css({"z-index":"1"})});$elem.css({"z-index":"3"})})}$(this).css({width:newWidth+"%",left:newLeft+"%",right:0})})})})}},_groupOverlappingEventElements:function($weekDay){var $events=$weekDay.find(".wc-cal-event:visible");var sortedEvents=$events.sort(function(a,b){return $(a).data("calEvent").start.getTime()-$(b).data("calEvent").start.getTime()});var lastEndTime=new Date(0,0,0);var groups=[];var curGroups=[];var $curEvent;$.each(sortedEvents,function(){$curEvent=$(this);if(curGroups.length>0){if(lastEndTime.getTime()<=$curEvent.data("calEvent").start.getTime()){groups.push(curGroups);curGroups=[]}}for(var groupIndex=0;groupIndex<curGroups.length;groupIndex++){if(curGroups[groupIndex].length>0){if(curGroups[groupIndex][curGroups[groupIndex].length-1].data("calEvent").end.getTime()<=$curEvent.data("calEvent").start.getTime()){curGroups[groupIndex].push($curEvent);if(lastEndTime.getTime()<$curEvent.data("calEvent").end.getTime()){lastEndTime=$curEvent.data("calEvent").end}return}}}curGroups.push([$curEvent]);if(lastEndTime.getTime()<$curEvent.data("calEvent").end.getTime()){lastEndTime=$curEvent.data("calEvent").end}});if(curGroups.length>0){groups.push(curGroups)}return groups},_findWeekDayForEvent:function(calEvent,$weekDayColumns){var $weekDay,options=this.options,showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,user_ids=this._getEventUserId(calEvent);if(!$.isArray(user_ids)){user_ids=[user_ids]}$weekDayColumns.each(function(index,curDay){if($(this).data("startDate").getTime()<=calEvent.start.getTime()&&$(this).data("endDate").getTime()>=calEvent.end.getTime()&&(!showAsSeparatedUser||$.inArray($(this).data("wcUserId"),user_ids)!==-1)){if($weekDay){$weekDay=$weekDay.add($(curDay))}else{$weekDay=$(curDay)}}});return $weekDay},_updateEventInCalendar:function(calEvent){var self=this;self._cleanEvent(calEvent);if(calEvent.id){self.element.find(".wc-cal-event").each(function(){if($(this).data("calEvent").id===calEvent.id||$(this).hasClass("wc-new-cal-event")){$(this).remove()}})}var $weekDays=self._findWeekDayForEvent(calEvent,self.element.find(".wc-grid-row-events .wc-day-column-inner"));if($weekDays){$weekDays.each(function(index,weekDay){var $weekDay=$(weekDay);var $calEvent=self._renderEvent(calEvent,$weekDay);self._adjustForEventCollisions($weekDay,$calEvent,calEvent,calEvent);self._refreshEventDetails(calEvent,$calEvent);self._positionEvent($weekDay,$calEvent);self._adjustOverlappingEvents($weekDay)})}},_positionEvent:function($weekDay,$calEvent){var options=this.options;var calEvent=$calEvent.data("calEvent");var pxPerMillis=$weekDay.height()/options.millisToDisplay;var firstHourDisplayed=options.businessHours.limitDisplay?options.businessHours.start:0;var startMillis=this._getDSTdayShift(calEvent.start).getTime()-this._getDSTdayShift(new Date(calEvent.start.getFullYear(),calEvent.start.getMonth(),calEvent.start.getDate(),firstHourDisplayed)).getTime();var eventMillis=this._getDSTdayShift(calEvent.end).getTime()-this._getDSTdayShift(calEvent.start).getTime();var pxTop=pxPerMillis*startMillis;var pxHeight=pxPerMillis*eventMillis-options.eventSeparation;$calEvent.css({top:pxTop,height:pxHeight||(pxPerMillis*3600000/options.timeslotsPerHour)})},_getEventDurationFromPositionedEventElement:function($weekDay,$calEvent,top){var options=this.options;var startOffsetMillis=options.businessHours.limitDisplay?options.businessHours.start*3600000:0;var start=new Date($weekDay.data("startDate").getTime()+startOffsetMillis+Math.round(top/options.timeslotHeight)*options.millisPerTimeslot);var end=new Date(start.getTime()+($calEvent.height()/options.timeslotHeight)*options.millisPerTimeslot);return{start:this._getDSTdayShift(start,-1),end:this._getDSTdayShift(end,-1)}},_adjustForEventCollisions:function($weekDay,$calEvent,newCalEvent,oldCalEvent,maintainEventDuration){var options=this.options;if(options.allowCalEventOverlap){return}var adjustedStart,adjustedEnd;var self=this;$weekDay.find(".wc-cal-event").not($calEvent).each(function(){var currentCalEvent=$(this).data("calEvent");if(newCalEvent.start.getTime()<currentCalEvent.end.getTime()&&newCalEvent.end.getTime()>=currentCalEvent.end.getTime()){adjustedStart=currentCalEvent.end}if(newCalEvent.end.getTime()>currentCalEvent.start.getTime()&&newCalEvent.start.getTime()<=currentCalEvent.start.getTime()){adjustedEnd=currentCalEvent.start}if(oldCalEvent.resizable==false||(newCalEvent.end.getTime()<=currentCalEvent.end.getTime()&&newCalEvent.start.getTime()>=currentCalEvent.start.getTime())){adjustedStart=oldCalEvent.start;adjustedEnd=oldCalEvent.end;return false}});newCalEvent.start=adjustedStart||newCalEvent.start;if(adjustedStart&&maintainEventDuration){newCalEvent.end=new Date(adjustedStart.getTime()+(oldCalEvent.end.getTime()-oldCalEvent.start.getTime()));self._adjustForEventCollisions($weekDay,$calEvent,newCalEvent,oldCalEvent)}else{newCalEvent.end=adjustedEnd||newCalEvent.end}if(newCalEvent.start.getTime()>=newCalEvent.end.getTime()){newCalEvent.start=oldCalEvent.start;newCalEvent.end=oldCalEvent.end}$calEvent.data("calEvent",newCalEvent)},_addDraggableToCalEvent:function(calEvent,$calEvent){var options=this.options;$calEvent.draggable({handle:".wc-time",containment:"div.wc-time-slots",snap:'.wc-day-column-inner',snapMode:'inner',snapTolerance:options.timeslotHeight-1,revert:'invalid',opacity:0.5,grid:[$calEvent.outerWidth()+1,options.timeslotHeight],start:function(event,ui){var $calEvent=ui.draggable;options.eventDrag(calEvent,$calEvent)}})},_addDroppableToWeekDay:function($weekDay){var self=this;var options=this.options;$weekDay.droppable({accept:".wc-cal-event",drop:function(event,ui){var $calEvent=ui.draggable;var top=Math.round(parseInt(ui.position.top));var eventDuration=self._getEventDurationFromPositionedEventElement($weekDay,$calEvent,top);var calEvent=$calEvent.data("calEvent");var newCalEvent=$.extend(true,{},calEvent,{start:eventDuration.start,end:eventDuration.end});var showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length;if(showAsSeparatedUser){var newUserId=$weekDay.data('wcUserId');var userIdList=self._getEventUserId(calEvent);var oldUserId=$(ui.draggable.parents('.wc-day-column-inner').get(0)).data('wcUserId');if(!$.isArray(userIdList)){userIdList=[userIdList]}if($.inArray(newUserId,userIdList)==-1){var _index=$.inArray(oldUserId,userIdList);userIdList.splice(_index,1);if($.inArray(newUserId,userIdList)==-1){userIdList.push(newUserId)}}newCalEvent=self._setEventUserId(newCalEvent,((userIdList.length==1)?userIdList[0]:userIdList))}self._adjustForEventCollisions($weekDay,$calEvent,newCalEvent,calEvent,true);var $weekDayColumns=self.element.find(".wc-day-column-inner");options.eventDrop(newCalEvent,calEvent,$calEvent);var $newEvent=self._renderEvent(newCalEvent,self._findWeekDayForEvent(newCalEvent,$weekDayColumns));$calEvent.hide();$calEvent.data("preventClick",true);var $weekDayOld=self._findWeekDayForEvent($calEvent.data("calEvent"),self.element.find(".wc-time-slots .wc-day-column-inner"));if($weekDayOld.data("startDate")!=$weekDay.data("startDate")){self._adjustOverlappingEvents($weekDayOld)}self._adjustOverlappingEvents($weekDay);setTimeout(function(){$calEvent.remove()},1000)}})},_addResizableToCalEvent:function(calEvent,$calEvent,$weekDay){var self=this;var options=this.options;$calEvent.resizable({grid:options.timeslotHeight,containment:$weekDay,handles:"s",minHeight:options.timeslotHeight,stop:function(event,ui){var $calEvent=ui.element;var newEnd=new Date($calEvent.data("calEvent").start.getTime()+Math.max(1,Math.round(ui.size.height/options.timeslotHeight))*options.millisPerTimeslot);if(self._needDSTdayShift($calEvent.data("calEvent").start,newEnd))newEnd=self._getDSTdayShift(newEnd,-1);var newCalEvent=$.extend(true,{},calEvent,{start:calEvent.start,end:newEnd});self._adjustForEventCollisions($weekDay,$calEvent,newCalEvent,calEvent);self._refreshEventDetails(newCalEvent,$calEvent);self._positionEvent($weekDay,$calEvent);self._adjustOverlappingEvents($weekDay);options.eventResize(newCalEvent,calEvent,$calEvent);$calEvent.data("preventClick",true);setTimeout(function(){$calEvent.removeData("preventClick")},500)}});$('.ui-resizable-handle',$calEvent).text('=')},_refreshEventDetails:function(calEvent,$calEvent){$calEvent.find(".wc-time").html(this.options.eventHeader(calEvent,this.element));$calEvent.find(".wc-title").html(this.options.eventBody(calEvent,this.element));$calEvent.data("calEvent",calEvent);this.options.eventRefresh(calEvent,$calEvent)},_clearCalendar:function(){this.element.find(".wc-day-column-inner div").remove();this._clearFreeBusys()},_scrollToHour:function(hour,animate){var self=this;var options=this.options;var $scrollable=this.element.find(".wc-scrollable-grid");var slot=hour;if(self.options.businessHours.limitDisplay){if(hour<=self.options.businessHours.start){slot=0}else if(hour>=self.options.businessHours.end){slot=self.options.businessHours.end-self.options.businessHours.start-1}else{slot=hour-self.options.businessHours.start}}var $target=this.element.find(".wc-grid-timeslot-header .wc-hour-header:eq("+slot+")");$scrollable.animate({scrollTop:0},0,function(){var targetOffset=$target.offset().top;var scroll=targetOffset-$scrollable.offset().top-$target.outerHeight();if(animate){$scrollable.animate({scrollTop:scroll},options.scrollToHourMillis)}else{$scrollable.animate({scrollTop:scroll},0)}})},_hourForIndex:function(index){if(index===0){return 12}else if(index<13){return index}else{return index-12}},_24HourForIndex:function(index){if(index===0){return"00:00"}else if(index<10){return"0"+index+":00"}else{return index+":00"}},_amOrPm:function(hourOfDay){return hourOfDay<12?"AM":"PM"},_isToday:function(date){var clonedDate=this._cloneDate(date);this._clearTime(clonedDate);var today=new Date();this._clearTime(today);return today.getTime()===clonedDate.getTime()},_cleanEvents:function(events){var self=this;$.each(events,function(i,event){self._cleanEvent(event)});return events},_cleanEvent:function(event){if(event.date){event.start=event.date}event.start=this._cleanDate(event.start);event.end=this._cleanDate(event.end);if(!event.end){event.end=this._addDays(this._cloneDate(event.start),1)}},_disableTextSelect:function($elements){$elements.each(function(){if($.browser.mozilla){$(this).css('MozUserSelect','none')}else if($.browser.msie){$(this).bind('selectstart',function(){return false})}else{$(this).mousedown(function(){return false})}})},_dateFirstDayOfWeek:function(date){var self=this;var midnightCurrentDate=new Date(date.getFullYear(),date.getMonth(),date.getDate());var adjustedDate=new Date(midnightCurrentDate);adjustedDate.setDate(adjustedDate.getDate()-self._getAdjustedDayIndex(midnightCurrentDate));if(this.options.minDate!==null){var minDate=this._cleanDate(this.options.minDate);if(adjustedDate.getTime()<minDate.getTime())adjustedDate=minDate}if(this.options.maxDate!==null){var maxDate=this._cleanDate(this.options.maxDate);maxDate.setDate(maxDate.getDate()-this.options.daysToShow+1);if(adjustedDate.getTime()>maxDate.getTime())adjustedDate=maxDate}return adjustedDate},_dateLastDayOfWeek:function(date){var self=this;var midnightCurrentDate=new Date(date.getFullYear(),date.getMonth(),date.getDate());var adjustedDate=new Date(midnightCurrentDate);var daysToAdd=(self.options.daysToShow-1-self._getAdjustedDayIndex(midnightCurrentDate));adjustedDate.setDate(adjustedDate.getDate()+daysToAdd);if(this.options.minDate!==null){var minDate=this._cleanDate(this.options.minDate);minDate.setDate(minDate.getDate()+this.options.daysToShow-1);if(adjustedDate.getTime()<minDate.getTime())adjustedDate=minDate}if(this.options.maxDate!==null){var maxDate=this._cleanDate(this.options.maxDate);if(adjustedDate.getTime()>maxDate.getTime())adjustedDate=maxDate}return adjustedDate},_getAdjustedDayIndex:function(date){if(!this._startOnFirstDayOfWeek()){return 0}var midnightCurrentDate=new Date(date.getFullYear(),date.getMonth(),date.getDate());var currentDayOfStandardWeek=midnightCurrentDate.getDay();var days=[0,1,2,3,4,5,6];this._rotate(days,this._firstDayOfWeek());return days[currentDayOfStandardWeek]},_firstDayOfWeek:function(){if($.isFunction(this.options.firstDayOfWeek)){return this.options.firstDayOfWeek(this.element)}return this.options.firstDayOfWeek},_dateLastMilliOfWeek:function(date){var lastDayOfWeek=this._dateLastDayOfWeek(date);return new Date(lastDayOfWeek.getTime()+(MILLIS_IN_DAY))},_clearTime:function(d){d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);return d},_addDays:function(d,n,keepTime){d.setDate(d.getDate()+n);if(keepTime){return d}return this._clearTime(d)},_rotate:function(a,p){for(var l=a.length,p=(Math.abs(p)>=l&&(p%=l),p<0&&(p+=l),p),i,x;p;p=(Math.ceil(l/p)-1)*p-l+(l=p)){for(i=l;i>p;x=a[--i],a[i]=a[i-p],a[i-p]=x){}}return a},_cloneDate:function(d){return new Date(d.getTime())},_cleanDate:function(d){if(typeof d=='string'){return Date.parse(d)||new Date(parseInt(d,10))}if(typeof d=='number'){return new Date(d)}return d},_formatDate:function(date,format){var returnStr='';for(var i=0;i<format.length;i++){var curChar=format.charAt(i);if(i!=0&&format.charAt(i-1)=="\\"){returnStr+=curChar}else if(this._replaceChars[curChar]){returnStr+=this._replaceChars[curChar](date,this._formatDate)}else if(curChar!="\\"){returnStr+=curChar}}return returnStr},_replaceChars:{shortMonths:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],longMonths:['January','February','March','April','May','June','July','August','September','October','November','December'],shortDays:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],longDays:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],d:function(date){return(date.getDate()<10?'0':'')+date.getDate()},D:function(date){return this.shortDays[date.getDay()]},j:function(date){return date.getDate()},l:function(date){return this.longDays[date.getDay()]},N:function(date){return date.getDay()+1},S:function(date){return(date.getDate()%10==1&&date.getDate()!=11?'st':(date.getDate()%10==2&&date.getDate()!=12?'nd':(date.getDate()%10==3&&date.getDate()!=13?'rd':'th')))},w:function(date){return date.getDay()},z:function(date){var d=new Date(date.getFullYear(),0,1);return Math.ceil((date-d)/86400000)}, W:function(date){var d=new Date(date.getFullYear(),0,1);return Math.ceil((((date-d)/86400000)+d.getDay()+1)/7)},F:function(date){return this.longMonths[date.getMonth()]},m:function(date){return(date.getMonth()<9?'0':'')+(date.getMonth()+1)},M:function(date){return this.shortMonths[date.getMonth()]},n:function(date){return date.getMonth()+1},t:function(date){var d=new Date();return new Date(d.getFullYear(),d.getMonth(),0).getDate()},L:function(date){var year=date.getFullYear();return(year%400==0||(year%100!=0&&year%4==0))},o:function(date){var d=new Date(date.valueOf());d.setDate(d.getDate()-((date.getDay()+6)%7)+3);return d.getFullYear()},Y:function(date){return date.getFullYear()},y:function(date){return(''+date.getFullYear()).substr(2)},a:function(date){return date.getHours()<12?'am':'pm'},A:function(date){return date.getHours()<12?'AM':'PM'},B:function(date){return Math.floor((((date.getUTCHours()+1)%24)+date.getUTCMinutes()/60+date.getUTCSeconds()/ 3600) * 1000/24)}, g:function(date){return date.getHours()%12||12},G:function(date){return date.getHours()},h:function(date){return((date.getHours()%12||12)<10?'0':'')+(date.getHours()%12||12)},H:function(date){return(date.getHours()<10?'0':'')+date.getHours()},i:function(date){return(date.getMinutes()<10?'0':'')+date.getMinutes()},s:function(date){return(date.getSeconds()<10?'0':'')+date.getSeconds()},u:function(date){var m=date.getMilliseconds();return(m<10?'00':(m<100?'0':''))+m},e:function(date){return"Not Yet Supported"},I:function(date){return"Not Yet Supported"},O:function(date){return(-date.getTimezoneOffset()<0?'-':'+')+(Math.abs(date.getTimezoneOffset()/60)<10?'0':'')+(Math.abs(date.getTimezoneOffset()/60))+'00'},P:function(date){return(-date.getTimezoneOffset()<0?'-':'+')+(Math.abs(date.getTimezoneOffset()/60)<10?'0':'')+(Math.abs(date.getTimezoneOffset()/60))+':00'},T:function(date){var m=date.getMonth();date.setMonth(0);var result=date.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,'$1');date.setMonth(m);return result},Z:function(date){return-date.getTimezoneOffset()*60},c:function(date,_formatDate){return _formatDate("Y-m-d\\TH:i:sP")},r:function(date){return date.toString()},U:function(date){return date.getTime()/1000}},getUserForId:function(id){return $.extend({},this.options.users[this._getUserIndexFromId(id)])},_getUserName:function(index){var self=this;var options=this.options;var user=options.users[index];if($.isFunction(options.getUserName)){return options.getUserName(user,index,self.element)}else{return user}},_getUserIdFromIndex:function(index){var self=this;var options=this.options;if($.isFunction(options.getUserId)){return options.getUserId(options.users[index],index,self.element)}return index},_getUserIndexFromId:function(id){var self=this;var options=this.options;for(var i=0;i<options.users.length;i++){if(self._getUserIdFromIndex(i)==id){return i}}return 0},_getEventUserId:function(calEvent){var self=this;var options=this.options;if(options.showAsSeparateUsers&&options.users&&options.users.length){if($.isFunction(options.getEventUserId)){return options.getEventUserId(calEvent,self.element)}return calEvent.userId}return[]},_setEventUserId:function(calEvent,userId){var self=this;var options=this.options;if($.isFunction(options.setEventUserId)){return options.setEventUserId(userId,calEvent,self.element)}calEvent.userId=userId;return calEvent},_getFreeBusyUserId:function(freeBusy){var self=this;var options=this.options;if($.isFunction(options.getFreeBusyUserId)){return options.getFreeBusyUserId(freeBusy.getOption(),self.element)}return freeBusy.getOption('userId')},_clearFreeBusys:function(){if(this.options.displayFreeBusys){var self=this,options=this.options,$freeBusyPlaceholders=self.element.find('.wc-grid-row-freebusy .wc-column-freebusy');$freeBusyPlaceholders.each(function(){$(this).data('wcFreeBusyManager',new FreeBusyManager({start:self._cloneDate($(this).data("startDate")),end:self._cloneDate($(this).data("endDate")),defaultFreeBusy:options.defaultFreeBusy||{}}))});self.element.find('.wc-grid-row-freebusy .wc-freebusy').remove()}},_findWeekDaysForFreeBusy:function(freeBusy,$weekDays){var $returnWeekDays,options=this.options,showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,self=this,userList=self._getFreeBusyUserId(freeBusy);if(!$.isArray(userList)){userList=userList!='undefined'?[userList]:[]}if(!$weekDays){$weekDays=self.element.find('.wc-grid-row-freebusy .wc-column-freebusy')}$weekDays.each(function(){var manager=$(this).data('wcFreeBusyManager'),has_overlap=manager.isWithin(freeBusy.getStart())||manager.isWithin(freeBusy.getEnd())||freeBusy.isWithin(manager.getStart())||freeBusy.isWithin(manager.getEnd()),userId=$(this).data('wcUserId');if(has_overlap&&(!showAsSeparatedUser||($.inArray(userId,userList)!=-1))){$returnWeekDays=$returnWeekDays?$returnWeekDays.add($(this)):$(this)}});return $returnWeekDays},_renderFreeBusys:function(freeBusys){if(this.options.displayFreeBusys){var self=this,$freeBusyPlaceholders=self.element.find('.wc-grid-row-freebusy .wc-column-freebusy'),freebusysToRender;if($.isArray(freeBusys)){freebusysToRender=self._cleanFreeBusys(freeBusys)}else if(freeBusys.freebusys){freebusysToRender=self._cleanFreeBusys(freeBusys.freebusys)}else{freebusysToRender=[]}$.each(freebusysToRender,function(index,freebusy){var $placeholders=self._findWeekDaysForFreeBusy(freebusy,$freeBusyPlaceholders);if($placeholders){$placeholders.each(function(){var manager=$(this).data('wcFreeBusyManager');manager.insertFreeBusy(new FreeBusy(freebusy.getOption()));$(this).data('wcFreeBusyManager',manager)})}});self._refreshFreeBusys($freeBusyPlaceholders)}},_refreshFreeBusys:function($freeBusyPlaceholders){if(this.options.displayFreeBusys&&$freeBusyPlaceholders){var self=this,options=this.options,start=(options.businessHours.limitDisplay?options.businessHours.start:0),end=(options.businessHours.limitDisplay?options.businessHours.end:24);$freeBusyPlaceholders.each(function(){var $placehoder=$(this);var s=self._cloneDate($placehoder.data('startDate')),e=self._cloneDate(s);s.setHours(start);e.setHours(end);$placehoder.find('.wc-freebusy').remove();$.each($placehoder.data('wcFreeBusyManager').getFreeBusys(s,e),function(){self._renderFreeBusy(this,$placehoder)})})}},_renderFreeBusy:function(freeBusy,$freeBusyPlaceholder){if(this.options.displayFreeBusys){var self=this,options=this.options,freeBusyHtml='<div class="wc-freebusy"></div>';var $fb=$(freeBusyHtml);$fb.data('wcFreeBusy',new FreeBusy(freeBusy.getOption()));this._positionFreeBusy($freeBusyPlaceholder,$fb);$fb=options.freeBusyRender(freeBusy.getOption(),$fb,self.element);if($fb){$fb.appendTo($freeBusyPlaceholder)}}},_positionFreeBusy:function($placeholder,$freeBusy){var options=this.options;var freeBusy=$freeBusy.data("wcFreeBusy");var pxPerMillis=$placeholder.height()/options.millisToDisplay;var firstHourDisplayed=options.businessHours.limitDisplay?options.businessHours.start:0;var startMillis=freeBusy.getStart().getTime()-new Date(freeBusy.getStart().getFullYear(),freeBusy.getStart().getMonth(),freeBusy.getStart().getDate(),firstHourDisplayed).getTime();var eventMillis=freeBusy.getEnd().getTime()-freeBusy.getStart().getTime();var pxTop=pxPerMillis*startMillis;var pxHeight=pxPerMillis*eventMillis;$freeBusy.css({top:pxTop,height:pxHeight})},_cleanFreeBusys:function(freebusys){var self=this,freeBusyToReturn=[];if(!$.isArray(freebusys)){var freebusys=[freebusys]}$.each(freebusys,function(i,freebusy){freeBusyToReturn.push(new FreeBusy(self._cleanFreeBusy(freebusy)))});return freeBusyToReturn},_cleanFreeBusy:function(freebusy){if(freebusy.date){freebusy.start=freebusy.date}freebusy.start=this._cleanDate(freebusy.start);freebusy.end=this._cleanDate(freebusy.end);return freebusy},getFreeBusyManagersFor:function(date,users){var calEvent={start:date,end:date};this._setEventUserId(calEvent,users);return this.getFreeBusyManagerForEvent(calEvent)},getFreeBusyManagerForEvent:function(newCalEvent){var self=this,options=this.options,freeBusyManager;if(options.displayFreeBusys){var $freeBusyPlaceHoders=self.element.find('.wc-grid-row-freebusy .wc-column-freebusy'),freeBusy=new FreeBusy({start:newCalEvent.start,end:newCalEvent.end}),showAsSeparatedUser=options.showAsSeparateUsers&&options.users&&options.users.length,userId=showAsSeparatedUser?self._getEventUserId(newCalEvent):null;if(!$.isArray(userId)){userId=[userId]}$freeBusyPlaceHoders.each(function(){var manager=$(this).data('wcFreeBusyManager'),has_overlap=manager.isWithin(freeBusy.getEnd())||manager.isWithin(freeBusy.getEnd())||freeBusy.isWithin(manager.getStart())||freeBusy.isWithin(manager.getEnd());if(has_overlap&&(!showAsSeparatedUser||$.inArray($(this).data('wcUserId'),userId)!=-1)){freeBusyManager=$(this).data('wcFreeBusyManager');return false}})}return freeBusyManager},updateFreeBusy:function(freeBusys){var self=this,options=this.options;if(options.displayFreeBusys){var $toRender,$freeBusyPlaceHoders=self.element.find('.wc-grid-row-freebusy .wc-column-freebusy'),_freeBusys=self._cleanFreeBusys(freeBusys);$.each(_freeBusys,function(index,_freeBusy){var $weekdays=self._findWeekDaysForFreeBusy(_freeBusy,$freeBusyPlaceHoders);if($weekdays.length){$weekdays.each(function(index,day){var manager=$(day).data('wcFreeBusyManager');manager.insertFreeBusy(_freeBusy);$(day).data('wcFreeBusyManager',manager)});$toRender=$toRender?$toRender.add($weekdays):$weekdays}});self._refreshFreeBusys($toRender)}},_startOnFirstDayOfWeek:function(){return jQuery.isFunction(this.options.startOnFirstDayOfWeek)?this.options.startOnFirstDayOfWeek(this.element):this.options.startOnFirstDayOfWeek},_getCurrentScrollHour:function(){var self=this;var options=this.options;var $scrollable=this.element.find(".wc-scrollable-grid");var scroll=$scrollable.scrollTop();if(self.options.businessHours.limitDisplay){scroll=scroll+options.businessHours.start*options.timeslotHeight*options.timeslotsPerHour}return Math.round(scroll/(options.timeslotHeight*options.timeslotsPerHour))+1},_getJsonOptions:function(){if($.isFunction(this.options.jsonOptions)){return $.extend({},this.options.jsonOptions(this.element))}if($.isPlainObject(this.options.jsonOptions)){return $.extend({},this.options.jsonOptions)}return{}},_getHeaderDate:function(date){var options=this.options;if(options.getHeaderDate&&$.isFunction(options.getHeaderDate)){return options.getHeaderDate(date,this.element)}var dayName=options.useShortDayNames?options.shortDays[date.getDay()]:options.longDays[date.getDay()];return dayName+(options.headerSeparator)+this._formatDate(date,options.dateFormat)},_getDSTdayShift:function(date,shift){var start=new Date(date.getFullYear(),date.getMonth(),date.getDate(),0);var offset1=start.getTimezoneOffset();var offset2=date.getTimezoneOffset();if(offset1==offset2)return date;shift=shift?shift:1;return new Date(date.getTime()-shift*(offset1>offset2?-1:1)*(Math.max(offset1,offset2)-Math.min(offset1,offset2))*60000)},_needDSTdayShift:function(date1,date2){return date1.getTimezoneOffset()!=date2.getTimezoneOffset()}});$.extend($.ui.weekCalendar,{version:'2.0-dev',updateLayoutOptions:{startOnFirstDayOfWeek:true,firstDayOfWeek:true,daysToShow:true,displayOddEven:true,timeFormat:true,dateFormat:true,use24Hour:true,useShortDayNames:true,businessHours:true,timeslotHeight:true,timeslotsPerHour:true,buttonText:true,height:true,shortMonths:true,longMonths:true,shortDays:true,longDays:true,textSize:true,users:true,showAsSeparateUsers:true,displayFreeBusys:true}});var MILLIS_IN_DAY=86400000;var MILLIS_IN_WEEK=MILLIS_IN_DAY*7;var FreeBusyProto={getStart:function(){return this.getOption('start')},getEnd:function(){return this.getOption('end')},getOption:function(){if(!arguments.length){return this.options};if(typeof(this.options[arguments[0]])!=='undefined'){return this.options[arguments[0]]}else if(typeof(arguments[1])!=='undefined'){return arguments[1]}return null},setOption:function(key,value){if(arguments.length==1){$.extend(this.options,arguments[0]);return this}this.options[key]=value;return this},isWithin:function(dateTime){return Math.floor(dateTime.getTime()/1000)>=Math.floor(this.getStart().getTime()/ 1000) && Math.floor(dateTime.getTime()/1000)<=Math.floor(this.getEnd().getTime()/1000)},isValid:function(){return this.getStart().getTime()<this.getEnd().getTime()}};var FreeBusy=function(options){this.options=$.extend({},options||{})};$.extend(FreeBusy.prototype,FreeBusyProto);var FreeBusyManager=function(options){this.options=$.extend({defaultFreeBusy:{}},options||{});this.freeBusys=[];this.freeBusys.push(new FreeBusy($.extend({start:this.getStart(),end:this.getEnd()},this.options.defaultFreeBusy)))};$.extend(FreeBusyManager.prototype,FreeBusyProto,{getFreeBusys:function(){switch(arguments.length){case 0:return this.freeBusys;case 1:var freeBusy=[];var start=arguments[0];if(!this.isWithin(start)){return freeBusy}$.each(this.freeBusys,function(){if(this.isWithin(start)){freeBusy.push(this)}if(Math.floor(this.getEnd().getTime()/1000)>Math.floor(start.getTime()/1000)){return false}});return freeBusy;default:var freeBusy=[];var start=arguments[0],end=arguments[1];var tmpFreeBusy=new FreeBusy({start:start,end:end});if(end.getTime()<start.getTime()||this.getStart().getTime()>end.getTime()||this.getEnd().getTime()<start.getTime()){return freeBusy}$.each(this.freeBusys,function(){if(this.getStart().getTime()>=end.getTime()){return false}if(tmpFreeBusy.isWithin(this.getStart())&&tmpFreeBusy.isWithin(this.getEnd())){freeBusy.push(this)}else if(this.isWithin(tmpFreeBusy.getStart())&&this.isWithin(tmpFreeBusy.getEnd())){var _f=new FreeBusy(this.getOption());_f.setOption('end',tmpFreeBusy.getEnd());_f.setOption('start',tmpFreeBusy.getStart());freeBusy.push(_f)}else if(this.isWithin(tmpFreeBusy.getStart())&&this.getStart().getTime()<start.getTime()){var _f=new FreeBusy(this.getOption());_f.setOption('start',tmpFreeBusy.getStart());freeBusy.push(_f)}else if(this.isWithin(tmpFreeBusy.getEnd())&&this.getEnd().getTime()>end.getTime()){var _f=new FreeBusy(this.getOption());_f.setOption('end',tmpFreeBusy.getEnd());freeBusy.push(_f)}});return freeBusy}},insertFreeBusy:function(freeBusy){var freeBusy=new FreeBusy(freeBusy.getOption());if(freeBusy.getStart().getTime()<this.getStart().getTime()){freeBusy.setOption('start',this.getStart())}if(freeBusy.getEnd().getTime()>this.getEnd().getTime()){freeBusy.setOption('end',this.getEnd())}var start=freeBusy.getStart(),end=freeBusy.getEnd(),startIndex=0,endIndex=this.freeBusys.length-1,newFreeBusys=[];var pushNewFreeBusy=function(_f){if(_f.isValid())newFreeBusys.push(_f)};$.each(this.freeBusys,function(index){var curFreeBusyItem=this;if(curFreeBusyItem.isWithin(start)&&curFreeBusyItem.isWithin(end)){startIndex=index;endIndex=index;if(start.getTime()==curFreeBusyItem.getStart().getTime()&&end.getTime()==curFreeBusyItem.getEnd().getTime()){var _f1=new FreeBusy(freeBusy.getOption());pushNewFreeBusy(_f1)}else if(start.getTime()==curFreeBusyItem.getStart().getTime()){var _f1=new FreeBusy(freeBusy.getOption());var _f2=new FreeBusy(curFreeBusyItem.getOption());_f2.setOption('start',end);pushNewFreeBusy(_f1);pushNewFreeBusy(_f2)}else if(end.getTime()==curFreeBusyItem.getEnd().getTime()){var _f1=new FreeBusy(curFreeBusyItem.getOption());_f1.setOption('end',start);var _f2=new FreeBusy(freeBusy.getOption());pushNewFreeBusy(_f1);pushNewFreeBusy(_f2)}else{var _f1=new FreeBusy(curFreeBusyItem.getOption());var _f2=new FreeBusy(freeBusy.getOption());var _f3=new FreeBusy(curFreeBusyItem.getOption());_f1.setOption('end',start);_f3.setOption('start',end);pushNewFreeBusy(_f1);pushNewFreeBusy(_f2);pushNewFreeBusy(_f3)}return false}else if(curFreeBusyItem.isWithin(start)&&curFreeBusyItem.getEnd().getTime()!=start.getTime()){if(curFreeBusyItem.getStart().getTime()!=start.getTime()){var _f1=new FreeBusy(curFreeBusyItem.getOption());_f1.setOption('end',start);pushNewFreeBusy(_f1)}startIndex=index}else if(curFreeBusyItem.isWithin(end)&&curFreeBusyItem.getStart().getTime()!=end.getTime()){pushNewFreeBusy(new FreeBusy(freeBusy.getOption()));if(end.getTime()<curFreeBusyItem.getEnd().getTime()){var _f1=new FreeBusy(curFreeBusyItem.getOption());_f1.setOption('start',end);pushNewFreeBusy(_f1)}endIndex=index;return false}});var tmpFB=this.freeBusys;this.freeBusys=[];if(startIndex){this.freeBusys=this.freeBusys.concat(tmpFB.slice(0,startIndex))}this.freeBusys=this.freeBusys.concat(newFreeBusys);if(endIndex<tmpFB.length){this.freeBusys=this.freeBusys.concat(tmpFB.slice(endIndex+1))}return this}})})(jQuery);
